//ui组件父类
function UI(uiJson,parentNode){deviceone.call(this);this.uiJson=uiJson;this.generationVirtualNodes={};this.eventFactory={};this.style={};this.address=guid();window.parent.UIFactory[this.address]=this;for(var key in uiJson){this[key]=uiJson[key]==="true"?true:uiJson[key];this[key]=uiJson[key]==="false"?false:uiJson[key]}if(parentNode)this.parentVirtualNode=parentNode;if(parentNode&&parentNode.ancestorVirtualNode)this.ancestorVirtualNode=parentNode.ancestorVirtualNode;this.nodeDidMount()}(function(){var Super=function(){};Super.prototype=deviceone.prototype;UI.prototype=new Super;UI.prototype.nodeWillMount=nodeWillMount;UI.prototype.nodeMounting=nodeMounting;UI.prototype.nodeDidMount=nodeDidMount;UI.prototype.nodeWillUpdate=nodeWillUpdate;UI.prototype.remove=remove;UI.prototype.bindData=bindData;UI.prototype.nodeDidUpdate=nodeDidUpdate;UI.prototype.nodeRefreshing=nodeRefreshing;UI.prototype.getVirtualChildrenNodes=getVirtualChildrenNodes;UI.prototype.getDOMElememt=getDOMElememt;UI.prototype.on=on;UI.prototype.getRect=getRect;UI.prototype.redraw=redraw;UI.prototype.setMapping=setMapping;UI.prototype.set=set;UI.prototype.get=get;UI.prototype.show=show;UI.prototype.hide=hide;UI.prototype.animate=animate;UI.prototype.refreshData=refreshData;function refreshData(){this.bindData(this.hashDataIns)}function animate(animationIns){var curveToTimingFunction={"EaseInOut":"ease-in-out","EaseIn":"ease-in","EaseOut":"ease-out","Linear":"linear"};if(animationIns.type==="do_Animation"){var animationFactory=animationIns.animationFactory;var fillAfter=animationIns.fillAfter;var autoReverseToDirection={"true":"alternate","false":"normal"};var fillAfterToFillMode={"true":"forwards","false":"none"};for(var id in animationFactory){var animation=animationFactory[id];this.DOMElement.style.animationName+=(this.DOMElement.style.animationName==""?"":",")+id;this.DOMElement.style.animationDuration+=(this.DOMElement.style.animationDuration==""?"":",")+animation.duration+"ms";this.DOMElement.style.animationDelay+=(this.DOMElement.style.animationDelay==""?"":",")+animation.delay+"ms";this.DOMElement.style.animationTimingFunction+=(this.DOMElement.style.animationTimingFunction==""?"":",")+curveToTimingFunction[animation.curve];this.DOMElement.style.animationIterationCount+=(this.DOMElement.style.animationIterationCount==""?"":",")+(animation.repeatCount===-1?"infinite":animation.repeatCount);this.DOMElement.style.animationDirection+=(this.DOMElement.style.animationIterationCount==""?"":",")+autoReverseToDirection[String(animation.autoReverse)];this.DOMElement.style.animationFillMode+=(this.DOMElement.style.animationFillMode==""?"":",")+fillAfterToFillMode[String(fillAfter)]}}else if(animationIns.type==="do_Animator")this.DOMElement.style.animation=animationIns.animate_id+" "+animationIns.duration+"ms"+" "+curveToTimingFunction[animationIns.curve]}function show(args){var animationType=args.animationType;var animationTime=args.animationTime;this.DOMElement.style.animation+=(this.DOMElement.style.animation==""?"":",")+animationType+" "+animationTime+"ms"}function hide(args){var animationType=args.animationType;var animationTime=args.animationTime;var that=this;this.DOMElement.addEventListener("webkitAnimationEnd",function(){that.DOMElement.style.visibility="hidden"},false);this.DOMElement.style.animation+=(this.DOMElement.style.animation==""?"":",")+animationType+"_hide"+" "+animationTime+"ms"}function set(data){for(var key in data)this[key]=data[key]}function get(data){var result={};for(var i=0;i<data.length;++i){var key=data[i];result[key]=this[key]}return result}function nodeWillMount(){}function nodeMounting(uiJson){}function nodeDidMount(){if(this.uiJS){this.ancestorVirtualNode=this;this.ancestorVirtualNode.generationVirtualNodes["$"]=this;this.uiJS="var that \x3d this;function ui(uiID){return uiID\x3d\x3d\x3d'$'?that:that.generationVirtualNodes[uiID]};"+this.uiJS}if(this.views)this.childrenVirtualNodes=this.getVirtualChildrenNodes();allVirtualNodes[this.id]=this;this.ancestorVirtualNode.generationVirtualNodes[this.id]=this;this.getDOMElememt();if(this.onDOMCreated)this.onDOMCreated();var that=this;Object.defineProperty(this,"y",{set:function(newValue){this.uiJson.y=newValue;that.DOMElement.top=getRealSize(newValue)},get:function(){return this.uiJson.y||this.defaultProps.y}});Object.defineProperty(this,"x",{set:function(newValue){this.uiJson.x=newValue;that.DOMElement.left=getRealSize(newValue)},get:function(){return this.uiJson.x||this.defaultProps.x}});if(this.uiJS){this.publicAPI=function(string){return eval(string)};eval(this.uiJS)}}function nodeWillUpdate(){}function nodeDidUpdate(){}function nodeRefreshing(uiJson){this.getDOMElememt()}function getVirtualChildrenNodes(){var childrenVirtualNodes=[];var views=this.views;for(var i=0;i<views.length;++i){var type=views[i].type;if(eval("typeof "+type)!=="function")window.eval(localStorage.getItem(type+".js"));var child=eval("(function(){return function a(uiJSON, parentNode){return (new "+type+"(uiJSON, parentNode));}})()").call(this,views[i],this);childrenVirtualNodes.push(child)}return childrenVirtualNodes}function getDOMElememt(){this.style.left="0px";this.style.top="0px";this.style.margin="0px";this.style.padding="0px";this.style.outline="none";this.style.height=getRealSize(80)+"px";this.style.width=getRealSize(100)+"px";this.style.overflow="hidden";this.style.display="inline-block";for(var key in this){var value=this[key];this[key]=value;switch(key){case "x":if(this.parentVirtualNode&&this.parentVirtualNode.type==="do_ALayout"){this.style.position="absolute";this.style.left=getRealSize(value)+"px"}break;case "y":if(this.parentVirtualNode&&this.parentVirtualNode.type==="do_ALayout"){this.style.position="absolute";this.style.top=getRealSize(value)+"px"}break;case "margin":if(this.parentVirtualNode&&this.parentVirtualNode.type==="do_LinearLayout"){var margin=value.split(",");this.style.marginTop=getRealSize(margin[0])+"px";this.style.marginRight=getRealSize(margin[1])+"px";this.style.marginBottom=getRealSize(margin[2])+"px";this.style.marginLeft=getRealSize(margin[3])+"px";break}break;case "width":if(value==-1)this.style.width="auto";else this.style.width=getRealSize(value)+"px";break;case "height":if(value==-1)this.style.height="auto";else this.style.height=getRealSize(value)+"px";break;case "border":var option=value.split(",");var color=option[0].substr(0,6);var width=getRealSize(option[1]);var radius=getRealSize(option[2]);this.style["border-color"]="#"+color;this.style["border-width"]=width+"px";this.style["border-radius"]=radius+"px";break;case "alpha":this.style.opacity=value;break;case "visible":this.style.visibility=value?"visible":"hidden";break;case "bgColor":this.style["background-color"]="#"+value.substr(0,6);break}}this.DOMElement=this.render();this.DOMElement.setAttribute("uiid",this.id);return this.DOMElement}function on(name,func){this.eventFactory[name]=this.eventFactory[name]?this.eventFactory[name]:[];this.eventFactory[name].push(func);var that=this}function getRect(){var rect=targetDOM.getBoundingClientRect();return{x:rect.left,y:rect.top,width:targetDOM.width,height:targetDOM.height}}function setMapping(dataMap){this.DataMapUI=dataMap}function bindData(hashDataIns){this.hashDataIns=hashDataIns;var data=hashDataIns.getAll();for(var key in this.DataMapUI){var uiID_property=key.split(".");if(uiID_property.length===2){var uiID=uiID_property[0];var property=uiID_property[1];var virtualNode=this.generationVirtualNodes[uiID];var value=this.DataMapUI[key];if(data[value]){virtualNode[property]=data[value];virtualNode.nodeRefreshing()}}}this.fire("dataRefreshed")}function redraw(){this.getDOMElememt()}function remove(){this.DOMElement.parentNode.removeChild(this.DOMElement);delete window.parent.UIFactory[this.address]}})();(function(){var TOUCHSTART,TOUCHEND;if(typeof window.ontouchstart!="undefined"){TOUCHSTART="touchstart";TOUCHEND="touchend";TOUCHMOVE="touchmove"}else if(typeof window.onmspointerdown!="undefined"){TOUCHSTART="MSPointerDown";TOUCHEND="MSPointerUp";TOUCHMOVE="MSPointerMove"}else{TOUCHSTART="mousedown";TOUCHEND="mouseup";TOUCHMOVE="mousemove"}function NodeTouch(node){this._node=node}function tap(node,callback,scope){node.addEventListener(TOUCHSTART,function(e){x=e.touches[0].pageX;y=e.touches[0].pageY});node.addEventListener(TOUCHEND,function(e){e.stopPropagation();e.preventDefault();var curx=e.changedTouches[0].pageX;var cury=e.changedTouches[0].pageY;if(Math.abs(curx-x)<6&&Math.abs(cury-y)<6)callback.apply(scope,arguments)})}function longTap(node,callback,scope){var x,y,startTime=0,endTime=0,in_dis=false;node.addEventListener(TOUCHSTART,function(e){x=e.touches[0].pageX;y=e.touches[0].pageY;startTime=(new Date).getTime()});node.addEventListener(TOUCHEND,function(e){e.stopPropagation();e.preventDefault();var curx=e.changedTouches[0].pageX;var cury=e.changedTouches[0].pageY;if(Math.abs(curx-x)<6&&Math.abs(cury-y)<6)in_dis=true;else in_dis=false;endTime=(new Date).getTime();if(endTime-startTime>300&&in_dis)callback.apply(scope,arguments)})}NodeTouch.prototype.on=function(evt,callback,scope){var scopeObj;var x,y;if(!scope)scopeObj=this._node;else scopeObj=scope;if(evt==="tap")tap(this._node,callback,scope);else if(evt==="longtap")longTap(this._node,callback,scope);else this._node.addEventListener(evt,function(){callback.apply(scope,arguments)});return this}})();