function do_ListView(uiJson,parentNode){this.type="do_ListView";var that=this;this.uiType=2;this.bounces=true;this.canScrollToTop=true;this.footerView="";this.headerView="";this.isFooterVisible=false;this.isHeaderVisible=false;this.isShowbar=true;this.selectedColor="ffffff00";this.templates="";this.defaultProps={bounces:true,canScrollToTop:true,footerView:"",headerView:"",isFooterVisible:false,isHeaderVisible:false,isShowbar:true,selectedColor:"ffffff00",templates:""};this.refreshItems=refreshItems;this.bindItems=bindItems;function refreshItems(){this.bindItems(this.listData)}function bindItems(listData){this.listData=listData;var data=listData.getAllData();this.views=[];for(var i=0;i<data.length;++i){var item=data[i];var templateIndex=item.template;var tempaltePaths=this.templates.split(",");var templatePath=tempaltePaths[templateIndex];var templateUiJson=getUIByPath(templatePath).RootView;this.views.push(templateUiJson)}this.childrenVirtualNodes=this.getVirtualChildrenNodes();for(var i=0;i<this.childrenVirtualNodes.length;++i){var virtualNode=this.childrenVirtualNodes[i];var datUIMap=virtualNode.DataMapUI;var one=data[i];var hashData=mm("do_HashData");hashData.addData(one);virtualNode.bindData(hashData)}this.getDOMElememt()}this.onDOMCreated=function(){var that=this;var newPosition=null;var firstVisiblePositionTemp=null;var lastVisiblePositionTemp=null;var rate=1;var startY;var totalTranslateY=0;var state;this.DOMElement.addEventListener("touchmove",function(event){if(that.isHeaderVisible){var pageY=event.changedTouches[0].pageY;var translateY=totalTranslateY+pageY-startY;if(that.DOMElement.scrollTop>0||that.DOMElement.scrollTop<=0&&translateY<0)return;if(isScrolling&&that.DOMElement.scrollTop<=0){totalTranslateY=totalTranslateY-(pageY-startY);translateY=translateY-(pageY-startY)}isScrolling=false;event.preventDefault();that.DOMElement.children[0].style["transform"]="translate3d(0px, "+translateY+"px, 0px)";var headerViewNodeHeight=getRealSize(that.headerViewNode.height);if(translateY<headerViewNodeHeight){state=0;that.fire("pull",{state:0,offset:getVirtualSize(totalTranslateY)})}else if(state===0){that.fire("pull",{state:1,offset:getVirtualSize(totalTranslateY)});state=1}}});this.DOMElement.addEventListener("touchstart",function(event){if(that.isHeaderVisible){that.DOMElement.children[0].style["will-change"]="transform";that.DOMElement.children[0].style["transition-property"]="transform";that.DOMElement.children[0].style["transition-duration"]="0ms";startY=event.changedTouches[0].pageY}});this.DOMElement.addEventListener("touchend",function(event){if(that.isHeaderVisible){var pageY=event.changedTouches[0].pageY;totalTranslateY+=pageY-startY;if(that.DOMElement.scrollTop>0)return;isScrolling=false;var headerViewNodeHeight=getRealSize(that.headerViewNode.height);if(totalTranslateY<headerViewNodeHeight){state=null;totalTranslateY=0;that.DOMElement.children[0].style["transition-duration"]="300ms";that.DOMElement.children[0].style["transform"]="translate3d(0px, 0px, 0px)"}else{that.DOMElement.children[0].style["transition-duration"]="300ms";that.DOMElement.children[0].style["transform"]="translate3d(0px, "+headerViewNodeHeight+"px, 0px)";totalTranslateY=headerViewNodeHeight;state=2;that.fire("pull",{state:2,offset:getVirtualSize(totalTranslateY)})}}});this.on("rebound",function(){state=null;totalTranslateY=0;that.DOMElement.children[0].style["transition-duration"]="300ms";that.DOMElement.children[0].style["transform"]="translate3d(0px, 0px, 0px)"});var isScrolling=false;this.DOMElement.addEventListener("scroll",function(event){state=null;totalTranslateY=0;if(!isScrolling){isScrolling=true;that.DOMElement.children[0].style["transition-duration"]="0ms";that.DOMElement.children[0].style["transform"]="translate3d(0px, 0px, 0px)"}var domElement=event.target;var scrollTop=domElement.scrollTop;var scrollHeight=domElement.scrollHeight;var childrenDOMElements=domElement.children;var firstVisiblePosition=null,lastVisiblePosition=null;for(var i=0;i<childrenDOMElements.length;++i){var child=childrenDOMElements[i];var y1=child.getBoundingClientRect().top;var y2=domElement.getBoundingClientRect().top;var y3=y1+child.getBoundingClientRect().height;var y4=child.getBoundingClientRect().top;var y5=y2+domElement.getBoundingClientRect().height;var y6=y4+child.getBoundingClientRect().height;if(firstVisiblePosition===null&&y2>=y1&&y2<=y3)firstVisiblePosition=i;if(lastVisiblePosition===null&&y5>=y4&&y5<=y6)lastVisiblePosition=i}if(firstVisiblePosition!==null&&firstVisiblePositionTemp!==null&&firstVisiblePosition>firstVisiblePositionTemp||lastVisiblePosition!==null&&lastVisiblePositionTemp!==null&&lastVisiblePosition>lastVisiblePositionTemp){if(lastVisiblePosition&&lastVisiblePosition!==lastVisiblePositionTemp)that.childrenVirtualNodes[lastVisiblePosition].fire("dataRefreshed")}else if(firstVisiblePosition!==null&&firstVisiblePositionTemp!==null&&firstVisiblePosition<firstVisiblePositionTemp||lastVisiblePosition!==null&&lastVisiblePositionTemp!==null&&lastVisiblePosition<lastVisiblePositionTemp)if(firstVisiblePosition&&firstVisiblePosition!==firstVisiblePositionTemp)that.childrenVirtualNodes[firstVisiblePosition].fire("dataRefreshed");firstVisiblePosition=firstVisiblePosition?firstVisiblePosition:0;lastVisiblePosition=lastVisiblePosition?lastVisiblePosition:parseInt(that.childrenVirtualNodes.length-1);firstVisiblePositionTemp=firstVisiblePosition;lastVisiblePositionTemp=lastVisiblePosition;that.fire("scroll",{firstVisiblePosition:firstVisiblePosition,lastVisiblePosition:lastVisiblePosition})});this.DOMElement.addEventListener("click",function(event){var pageY=event.pageY;var childrenVirtualNodes=that.childrenVirtualNodes;for(var i=0;i<childrenVirtualNodes.length;++i){var child=childrenVirtualNodes[i].DOMElement;var y1=child.getBoundingClientRect().top;var y2=y1+child.getBoundingClientRect().height;if(pageY>y1&&pageY<y2){that.fire("touch",i);that.fire("touch1",{position:i,y:getVirtualSize(y1)});break}}})};this.render=function(){var div=this.DOMElement?this.DOMElement:document.createElement("div");div.innerHTML="";var innerDIV=document.createElement("div");for(var key in this.style)div.style[key]=this.style[key];div.style.position="relative";div.style["-webkit-overflow-scrolling"]="touch";div.style.overflow="scroll";if(this.isHeaderVisible)if(this.headerView){var UI=getUIByPath(this.headerView).RootView;var type=UI.type;var downNode=eval("(function(){return function a(uiJSON, parentNode){return (new "+type+"(uiJSON, parentNode));}})()").call(this,UI,this);var downDOM=downNode.getDOMElememt();downDOM.style.position="absolute";downDOM.style.top="-"+getRealSize(downNode.height)+"px";downDOM.style.left="0px";innerDIV.appendChild(downDOM);this.headerViewNode=downNode}if(this.childrenVirtualNodes)for(var i=0;i<this.childrenVirtualNodes.length;++i){var virtualNode=this.childrenVirtualNodes[i];virtualNode.style.display="block";innerDIV.appendChild(virtualNode.getDOMElememt())}div.appendChild(innerDIV);return div};UI.call(this,uiJson,parentNode)}(function(){var Super=function(){};Super.prototype=UI.prototype;do_ListView.prototype=new Super})();